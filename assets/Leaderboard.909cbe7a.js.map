{"version":3,"file":"Leaderboard.909cbe7a.js","sources":["../../packages/leaderboard/Leaderboard.vue"],"sourcesContent":["<template>\n  <LayoutDefault>\n    <div class=\"p-2 md:p-10 md:m-auto xl:w-9/10 2xl:w-4/5\">\n      <div v-if=\"loading\">\n        {{ t('leaderboard.loading') }}\n      </div>\n      <div v-else-if=\"error\">\n        {{ error.message }}\n      </div>\n      <div v-else>\n        <PvTabs\n          v-model=\"currentRankType\"\n          :tabs=\"[\n            { name: 'tag-contributions', label: t('leaderboard.tag-contributions.name') },\n            { name: 'others', label: '其他排行榜' },\n          ]\"\n        >\n          <template #tag-contributions>\n            <div class=\"flex flex-col flex-nowrap justify-start items-center px-0 md:px-2\">\n              <PvSelect v-model=\"selectedDateRange\" class=\"md:w-1/4\" :item-list=\"dateRangeList\" />\n              <div class=\"rank-list w-full\">\n                <div v-for=\"(rankItem, i) in rankList\" :key=\"i\" class=\"rank-item w-full\">\n                  <div\n                    class=\"flex flex-row justify-between items-center w-full my-2 md:my-4 sm:h-36 md:h-30 p-4 hover:rounded-xl hover:bg-[#f4f4f5] hover:shadow-xl box-border transition-all duration-300 shadow-gray-500/20 cursor-pointer\"\n                  >\n                    <div class=\"flex flex-row justify-start items-center w-1/2 sm:w-1/3 md:w-1/5 h-full\">\n                      <div\n                        class=\"w-1/3 md:w-14 text-3xl text-center md:text-left text-gray-600 font-bold hover:opacity-70 transition-all duration-300 cursor-pointer\"\n                        :class=\"rankNumberTextIndexToClasses[i]\"\n                        v-text=\"i + 1\"\n                      />\n                      <RouterLink\n                        :to=\"`/user/${rankItem.user.id}`\"\n                        class=\"relative lt-md:w-2/3 md:min-w-max md:h-24 hover:opacity-70 transition-all duration-300 cursor-pointer\"\n                      >\n                        <!-- TODO add UserAvatarPopper here -->\n                        <UserAvatar\n                          class=\"md:w-full md:h-full rounded-full\"\n                          :alt=\"rankItem.user.username\"\n                          :image=\"rankItem.user.image\"\n                        />\n                      </RouterLink>\n                    </div>\n                    <div\n                      class=\"flex flex-col md:flex-row justify-between md:items-center w-1/2 sm:w-2/3 md:w-4/5 h-full lt-md:ml-2\"\n                    >\n                      <RouterLink :to=\"`/users/${rankItem.user.id}`\" class=\"w-full md:w-1/4 md:ml-8\">\n                        <div\n                          class=\"text-xl text-gray-600 font-bold hover:opacity-70 whitespace-nowrap overflow-hidden transition-all duration-300 cursor-pointer\"\n                          :class=\"rankNumberTextIndexToClasses[i]\"\n                          v-text=\"rankItem.user.username\"\n                        />\n                      </RouterLink>\n                      <div\n                        class=\"w-full md:w-1/3 lt-md:h-6 md:max-h-28 md:overflow-auto md:ml-4 lt-md:my-2 text-gray-500 text-ellipsis overflow-hidden md:overflow-clip whitespace-nowrap md:whitespace-normal box-border\"\n                        v-text=\"rankItem.user.desc\"\n                      />\n                      <div\n                        class=\"flex-grow w-full md:w-5/12 md:ml-8 text-left md:text-right text-xl font-bold text-gray-600 hover:opacity-70 whitespace-normal md:whitespace-nowrap transition-all duration-300 cursor-pointer\"\n                        :class=\"rankNumberTextIndexToClasses[i]\"\n                        v-text=\"t('leaderboard.tag-contributions.edit-time', rankItem.count)\"\n                      />\n                    </div>\n                  </div>\n                  <div class=\"w-full h-px my-4 md:my-8 bg-gray-400\" />\n                </div>\n              </div>\n            </div>\n          </template>\n          <template #others>\n            其他排行榜列表\n          </template>\n        </PvTabs>\n      </div>\n    </div>\n    <BackTop />\n  </LayoutDefault>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, reactive, ref, watchEffect } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport BackTop from '@/ui/components/BackTop.vue'\nimport UserAvatar from '@/user/components/UserAvatar.vue'\nimport PvTabs from '@/ui/components/PvTabs.vue'\nimport PvSelect from '@/ui/components/PvSelect.vue'\nimport type { Query } from '@/graphql'\nimport { gql, useQuery, useResult } from '@/graphql'\nimport { startProgress, stopProgress } from '@/nprogress'\n\nconst { t } = useI18n()\n\nconst currentRankType = ref('tag-contributions')\nconst dateRangeList = computed(() => [\n  { value: `${24 * 7 * 52 * 10}`, name: t('leaderboard.tag-contributions.date-range.all') },\n  { value: `${24 * 30}`, name: t('leaderboard.tag-contributions.date-range.last-month') },\n  { value: `${24 * 7}`, name: t('leaderboard.tag-contributions.date-range.last-week') },\n  { value: `${24}`, name: t('leaderboard.tag-contributions.date-range.last-day') },\n])\nconst selectedDateRange = ref(dateRangeList.value[0].value)\nconst rankNumberTextIndexToClasses = reactive<Record<number, string>>({\n  0: 'text-shadow-xl text-[#f77]',\n  1: 'text-shadow-xl text-[#228dff]',\n  2: 'text-shadow-xl text-[#54df31]',\n})\nconst { result, loading, error } = useQuery<Query>(\n  gql`\n    query ($dateRangeNumber: Int!) {\n      getLeaderboard(hrs: $dateRangeNumber, k: 30) {\n        items {\n          count\n          user {\n            id\n            username\n            desc\n            image\n          }\n        }\n      }\n    }\n  `,\n  {\n    dateRangeNumber: computed(() => parseInt(selectedDateRange.value)),\n  },\n  {\n    fetchPolicy: 'network-only',\n  },\n)\nwatchEffect(() => {\n  if (loading.value)\n    startProgress()\n  else\n    stopProgress()\n})\n\nconst rankList = useResult(result, [], data => data.getLeaderboard.items)\n</script>\n"],"names":["t","useI18n","currentRankType","ref","dateRangeList","computed","selectedDateRange","rankNumberTextIndexToClasses","reactive","result","loading","error","useQuery","gql","watchEffect","startProgress","stopProgress","rankList","useResult","data"],"mappings":"i7CA0FA,KAAA,CAAA,EAAAA,GAAAC,IAEAC,EAAAC,EAAA,mBAAA,EACAC,EAAAC,EAAA,IAAA,CAAqC,CAAA,MAAA,GAAA,GAAA,EAAA,GAAA,KAAA,KAAAL,EAAA,8CAAA,CAAA,EACqD,CAAA,MAAA,GAAA,GAAA,KAAA,KAAAA,EAAA,qDAAA,CAAA,EACF,CAAA,MAAA,GAAA,GAAA,IAAA,KAAAA,EAAA,oDAAA,CAAA,EACF,CAAA,MAAA,GAAA,KAAA,KAAAA,EAAA,mDAAA,CAAA,CACL,CAAA,EAEjFM,EAAAH,EAAAC,EAAA,MAAA,GAAA,KAAA,EACAG,EAAAC,EAAA,CAAsE,EAAA,6BACjE,EAAA,gCACA,EAAA,+BACA,CAAA,EAEL,CAAA,OAAAC,EAAA,QAAAC,EAAA,MAAAC,CAAA,EAAAC,EAAmCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IACjC,CAeA,gBAAAR,EAAA,IAAA,SAAAC,EAAA,KAAA,CAAA,CACmE,EACnE,CACA,YAAA,cACe,CACf,EAEFQ,EAAA,IAAA,CACEJ,EAAA,MACEK,IAEAC,GAAa,CAAA,EAGjB,MAAAC,EAAAC,EAAAT,EAAA,CAAA,EAAAU,GAAAA,EAAA,eAAA,KAAA"}