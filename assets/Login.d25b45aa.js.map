{"version":3,"file":"Login.d25b45aa.js","sources":["../../packages/user/Login.vue"],"sourcesContent":["<template>\n  <div class=\"login h-screen w-full md:min-h-xl bg-bottom bg-no-repeat bg-cover dark:filter dark:brightness-75\">\n    <div\n      class=\"flex flex-wrap content-between w-full md:w-80 h-full p-5 text-white md:text-black bg-white bg-opacity-50 filter drop-shadow-md backdrop-filter backdrop-blur-sm lt-md:shadow md:ml-48\"\n    >\n      <div class=\"w-full lt-md:text-center\">\n        <Logo :larger=\"20\" />\n        <div class=\"text-lg md:text-center\" v-text=\"t('user.login.title')\" />\n      </div>\n      <form class=\"w-full space-y-3\" autocomplete=\"on\" @submit.prevent=\"login\">\n        <div>\n          <div class=\"flex w-full border-b border-black\">\n            <div class=\"i-uil:user align-middle text-2xl\" />\n            <input\n              v-model=\"username\"\n              type=\"text\"\n              name=\"username\"\n              autocomplete=\"username\"\n              class=\"autofill outline-none w-full bg-transparent placeholder-white md:placeholder-gray-700 md:text-gray-700\"\n              :placeholder=\"t('user.login.username.placeholder')\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\" v-text=\"usernameStatus\" />\n        </div>\n        <div>\n          <div class=\"flex w-full border-b border-black\">\n            <div class=\"i-uil:padlock align-middle text-2xl\" />\n            <input\n              v-model=\"password\"\n              type=\"password\"\n              name=\"password\"\n              autocomplete=\"current-password\"\n              class=\"autofill outline-none w-full bg-transparent placeholder-white md:placeholder-gray-700 md:text-gray-700\"\n              :placeholder=\"t('user.login.password.placeholder')\"\n              @keydown.enter=\"login\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\" v-text=\"passwordStatus\" />\n          <RouterLink\n            class=\"block text-right text-xs text-blue-600\"\n            to=\"/user/forget-password\"\n          >\n            {{ t('user.login.forget-password') }}\n          </RouterLink>\n        </div>\n        <div class=\"space-y-1\">\n          <button\n            type=\"submit\"\n            :disabled=\"loginStatus === 'loading'\"\n            class=\"w-full py-2 border border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:bg-blue-700 disabled:bg-blue-300 disabled:focus:bg-blue-300 disabled:hover:bg-blue-300 disabled:hover:cursor-not-allowed\"\n            v-text=\"\n              loginStatus === 'loading' ? t('user.login.login-status.loading') : t('user.login.login-status.ready')\n            \"\n          />\n          <div v-if=\"loginStatus === 'error'\" class=\"text-red-500\" v-text=\"errmsg\" />\n          <RouterLink\n            class=\"block text-blue-600 hover:text-blue-800\"\n            to=\"/user/signup\"\n          >\n            {{ `${t('user.login.signup')}→` }}\n          </RouterLink>\n        </div>\n      </form>\n      <!-- This div is only for placeholder  -->\n      <div class=\"h-20 w-full\" />\n      <div>© VoileLabs 2019-2022</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\nimport { $fetch } from 'ohmyfetch'\nimport { useAuth } from '.'\nimport { setSiteTitle } from '@/common/libs/setSiteTitle'\nimport Logo from '@/common/components/Logo.vue'\n\nconst { t } = useI18n()\nconst router = useRouter()\nconst auth = useAuth()\n\nsetSiteTitle(`${t('user.login.title')} - PatchyVideo`)\n\nconst loginStatus = ref<'ready' | 'loading' | 'error'>('ready')\nconst UsernameStatus = {\n  fine: t('user.login.username.username-status.fine'),\n  tip: t('user.login.username.username-status.tip'),\n  msg: t('user.login.username.username-status.msg'),\n}\nconst usernameStatus = ref<string>(UsernameStatus.fine)\nconst PasswordStatus = {\n  fine: t('user.login.password.password-status.fine'),\n  tip: t('user.login.password.password-status.tip'),\n  msg: t('user.login.password.password-status.msg'),\n}\nconst passwordStatus = ref<string>(PasswordStatus.fine)\n\nconst username = ref<string>('')\nconst password = ref<string>('')\nconst errmsg = ref<string>('')\n\nasync function login(): Promise<void> {\n  if (loginStatus.value === 'loading')\n    return\n  loginStatus.value = 'loading'\n\n  /* Form validation  */\n  let valid = true\n  if (!username.value) {\n    valid = false\n    usernameStatus.value = UsernameStatus.tip\n  }\n  else if (username.value.length < 2 || username.value.length > 32) {\n    valid = false\n    usernameStatus.value = UsernameStatus.msg\n  }\n  else {\n    usernameStatus.value = UsernameStatus.fine\n  }\n  if (!password.value) {\n    valid = false\n    passwordStatus.value = PasswordStatus.tip\n  }\n  else if (password.value.length < 6 || password.value.length > 64) {\n    valid = false\n    passwordStatus.value = PasswordStatus.msg\n  }\n  else {\n    passwordStatus.value = PasswordStatus.fine\n  }\n  if (!valid) {\n    loginStatus.value = 'ready'\n    return\n  }\n\n  /* Login */\n  let session = ''\n  try {\n    const data = await $fetch<{\n      status: 'SUCCEED' | 'FAILED' | 'ERROR'\n      data?: string\n    }>('https://patchyvideo.com/be/auth/get_session.do', {\n      method: 'POST',\n      credentials: 'include',\n      body: {\n        type: 'LOGIN',\n      },\n    })\n    if (data.status === 'SUCCEED') {\n      session = data.data!\n    }\n    else {\n      loginStatus.value = 'error'\n      errmsg.value = t('user.login.login-status.error')\n      return\n    }\n  }\n  catch (err) {\n    errmsg.value = String(err)\n    loginStatus.value = 'error'\n    return\n  }\n\n  try {\n    const data = await $fetch<{\n      status: 'SUCCEED' | 'FAILED' | 'ERROR'\n    }>('https://patchyvideo.com/be/login.do', {\n      method: 'POST',\n      credentials: 'include',\n      body: {\n        username: username.value,\n        password: password.value,\n        session,\n      },\n    })\n\n    if (data.status === 'SUCCEED') {\n      loginStatus.value = 'ready'\n      await auth.refetch()\n      router.push('/')\n    }\n    else if (data.status === 'FAILED') {\n      loginStatus.value = 'error'\n      errmsg.value = t('user.login.login-status.failed')\n    }\n    else {\n      loginStatus.value = 'error'\n      // TODO\n      errmsg.value = data.dataerr.reason\n    }\n  }\n  catch (err) {\n    loginStatus.value = 'error'\n    errmsg.value = String(err)\n  }\n}\n</script>\n\n<style lang=\"postcss\" scoped>\n@media (max-width: 720px) {\n  .login {\n    background-image: url('./assets/LoginMobile.jpg');\n  }\n}\n@media (min-width: 720px) {\n  .login {\n    background-image: url('./assets/Login.jpg');\n  }\n}\n\n.autofill:-webkit-autofill,\n.autofill:-webkit-autofill:hover,\n.autofill:-webkit-autofill:focus {\n  transition: background-color 5000s ease-in-out 0s;\n  /* -webkit-text-fill-color: theme('colors.blue.300'); */\n  -webkit-text-fill-color: #93c5fd;\n}\n@media (min-width: 720px) {\n  .autofill:-webkit-autofill,\n  .autofill:-webkit-autofill:hover,\n  .autofill:-webkit-autofill:focus {\n    /* -webkit-text-fill-color: theme('colors.blue.900'); */\n    -webkit-text-fill-color: #1e3a8a;\n  }\n}\n</style>\n"],"names":["useI18n","router","useRouter","auth","useAuth","setSiteTitle","loginStatus","ref","UsernameStatus","usernameStatus","PasswordStatus","passwordStatus","username","password","errmsg","login","valid","session","data","$fetch","err"],"mappings":"4wCA+EA,KAAA,CAAA,GAAAA,IACAC,EAAAC,IACAC,EAAAC,IAEAC,EAAA,GAAA,EAAA,kBAAA,iBAAA,EAEA,MAAAC,EAAAC,EAAA,OAAA,EACAC,EAAA,CAAuB,KAAA,EAAA,0CAAA,EAC6B,IAAA,EAAA,yCAAA,EACF,IAAA,EAAA,yCAAA,CACA,EAElDC,EAAAF,EAAAC,EAAA,IAAA,EACAE,EAAA,CAAuB,KAAA,EAAA,0CAAA,EAC6B,IAAA,EAAA,yCAAA,EACF,IAAA,EAAA,yCAAA,CACA,EAElDC,EAAAJ,EAAAG,EAAA,IAAA,EAEAE,EAAAL,EAAA,EAAA,EACAM,EAAAN,EAAA,EAAA,EACAO,EAAAP,EAAA,EAAA,EAEA,eAAAQ,GAAA,CACE,GAAAT,EAAA,QAAA,UACE,OACFA,EAAA,MAAA,UAGA,IAAAU,EAAA,GAuBA,GAtBAJ,EAAA,MAEwCA,EAAA,MAAA,OAAA,GAAAA,EAAA,MAAA,OAAA,IAGtCI,EAAA,GACAP,EAAA,MAAAD,EAAA,KAGAC,EAAA,MAAAD,EAAA,MARAQ,EAAA,GACAP,EAAA,MAAAD,EAAA,KASFK,EAAA,MAEwCA,EAAA,MAAA,OAAA,GAAAA,EAAA,MAAA,OAAA,IAGtCG,EAAA,GACAL,EAAA,MAAAD,EAAA,KAGAC,EAAA,MAAAD,EAAA,MARAM,EAAA,GACAL,EAAA,MAAAD,EAAA,KASF,CAAAM,EAAA,CACEV,EAAA,MAAA,QACA,MAAA,CAIF,IAAAW,EAAA,GACA,GAAA,CACE,MAAAC,EAAA,MAAAC,EAAA,iDAAA,CAGqD,OAAA,OAC3C,YAAA,UACK,KAAA,CACP,KAAA,OACE,CACR,CAAA,EAEF,GAAAD,EAAA,SAAA,UACED,EAAAC,EAAA,SAAe,CAGfZ,EAAA,MAAA,QACAQ,EAAA,MAAA,EAAA,+BAAA,EACA,MAAA,CACF,OAAAM,EAAA,CAGAN,EAAA,MAAA,OAAAM,CAAA,EACAd,EAAA,MAAA,QACA,MAAA,CAGF,GAAA,CACE,MAAAY,EAAA,MAAAC,EAAA,sCAAA,CAE0C,OAAA,OAChC,YAAA,UACK,KAAA,CACP,SAAAP,EAAA,MACe,SAAAC,EAAA,MACA,QAAAI,CACnB,CACF,CAAA,EAGFC,EAAA,SAAA,WACEZ,EAAA,MAAA,QACA,MAAAH,EAAA,UACAF,EAAA,KAAA,GAAA,GAAeiB,EAAA,SAAA,UAGfZ,EAAA,MAAA,QACAQ,EAAA,MAAA,EAAA,gCAAA,IAGAR,EAAA,MAAA,QAEAQ,EAAA,MAAAI,EAAA,QAAA,OACF,OAAAE,EAAA,CAGAd,EAAA,MAAA,QACAQ,EAAA,MAAA,OAAAM,CAAA,CAAyB,CAC3B"}