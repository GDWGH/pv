{"version":3,"file":"CompPlaylist.b389ef9b.js","sources":["../../packages/home/components/CompPlaylist.vue"],"sourcesContent":["<template>\n  <div ref=\"el\" class=\"w-full\">\n    <div v-if=\"playlist\">\n      <VideoRow\n        :name=\"config.title ?? playlist.item.title\"\n        :title-links-to=\"`/playlist/${config.playlist_id}`\"\n        :videos=\"playlist.videos\"\n        :count=\"count\"\n        :rows=\"config.video_rows\"\n        :video-show-title=\"config.video_show_title\"\n        :video-show-date=\"config.video_show_date\"\n      />\n    </div>\n    <div v-else>\n      <VideoRowPlaceholder :count=\"count\" :rows=\"config.video_rows\" />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, reactive, ref, shallowRef, watchEffect } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { useElementSize, useIntersectionObserver } from '@vueuse/core'\nimport VideoRow from './VideoRow.vue'\nimport VideoRowPlaceholder from './VideoRowPlaceholder.vue'\nimport { gql, useLazyQuery, useResult } from '@/graphql'\nimport type { Query } from '@/graphql'\n\nconst props = withDefaults(\n  defineProps<{\n    data?: string\n  }>(),\n  {\n    data: '{}',\n  },\n)\n\nconst { t } = useI18n()\n\ninterface HomeCompDataList {\n  playlist_id: string\n  title?: string\n  title_pos: 'tl' | 'tr' | 'bl' | 'br'\n  video_show_title: boolean\n  video_show_date: boolean\n  video_rows: number\n}\n\nconst config = reactive<HomeCompDataList>({\n  playlist_id: '5e057a1b31929c83a76d18a4',\n  title_pos: 'tl',\n  video_show_title: true,\n  video_show_date: true,\n  video_rows: 1,\n  ...JSON.parse(props.data),\n})\n\nconst { result, load, fetchMore, forceDisabled } = useLazyQuery<Query>(\n  gql`\n    query ($pid: String!, $limit: Int!) {\n      getPlaylist(para: { pid: $pid }) {\n        item {\n          title\n          count\n        }\n        videos(offset: 0, limit: $limit) {\n          id\n          item {\n            title\n            coverImage\n          }\n          meta {\n            createdAt\n          }\n        }\n        meta {\n          createdAt\n          modifiedAt\n        }\n      }\n    }\n  `,\n  {},\n  {\n    notifyOnNetworkStatusChange: true,\n  },\n)\n\nconst el = shallowRef<HTMLElement | null>(null)\nconst { width } = useElementSize(el)\nconst count = computed(() => Math.floor(width.value / (240 + 16)) * config.video_rows)\nconst isInc = ref(false)\nlet shownCount = 0\nuseIntersectionObserver(\n  el,\n  ([{ isIntersecting }]) => {\n    isInc.value = isIntersecting\n  },\n  { rootMargin: '200px 200px 200px 200px' },\n)\nwatchEffect(() => {\n  if (shownCount === count.value || !isInc.value)\n    return\n  shownCount = count.value\n  if (result.value && shownCount <= result.value.getPlaylist.videos.length)\n    return\n  if (forceDisabled.value) {\n    load(undefined, { pid: config.playlist_id, limit: count.value })\n  }\n  else {\n    fetchMore({\n      variables: { pid: config.playlist_id, limit: count.value },\n      updateQuery(previousQueryResult, { fetchMoreResult }) {\n        if (!fetchMoreResult)\n          return previousQueryResult\n        return fetchMoreResult\n      },\n    })\n  }\n})\n\nconst playlist = useResult(result, null, data => data.getPlaylist)\n</script>\n"],"names":["useI18n","config","reactive","props","result","load","fetchMore","forceDisabled","useLazyQuery","gql","el","shallowRef","width","useElementSize","count","computed","isInc","ref","shownCount","useIntersectionObserver","isIntersecting","watchEffect","previousQueryResult","fetchMoreResult","playlist","useResult","data"],"mappings":"+uBAqCAA,EAAA,EAWA,MAAAC,EAAAC,EAAA,CAA0C,YAAA,2BAC3B,UAAA,KACF,iBAAA,GACO,gBAAA,GACD,WAAA,EACL,GAAA,KAAA,MAAAC,EAAA,IAAA,CACY,CAAA,EAG1B,CAAA,OAAAC,EAAA,KAAAC,EAAA,UAAAC,EAAA,cAAAC,CAAA,EAAAC,EAAmDC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IACjD,CAAA,EAwBC,CACD,4BAAA,EAC+B,CAC/B,EAGFC,EAAAC,EAAA,IAAA,EACA,CAAA,MAAAC,CAAA,EAAAC,EAAAH,CAAA,EACAI,EAAAC,EAAA,IAAA,KAAA,MAAAH,EAAA,OAAA,IAAA,GAAA,EAAAX,EAAA,UAAA,EACAe,EAAAC,EAAA,EAAA,EACA,IAAAC,EAAA,EACAC,EAAAT,EACE,CAAA,CAAA,CAAA,eAAAU,CAAA,CAAA,IAAA,CAEEJ,EAAA,MAAAI,CAAc,EAChB,CAAA,WAAA,yBAAA,CACwC,EAE1CC,EAAA,IAAA,CACEH,IAAAJ,EAAA,OAAA,CAAAE,EAAA,QAEAE,EAAAJ,EAAA,MACA,EAAAV,EAAA,OAAAc,GAAAd,EAAA,MAAA,YAAA,OAAA,UAEAG,EAAA,MACEF,EAAA,OAAA,CAAA,IAAAJ,EAAA,YAAA,MAAAa,EAAA,KAAA,CAAA,EAGAR,EAAA,CAAU,UAAA,CAAA,IAAAL,EAAA,YAAA,MAAAa,EAAA,KAAA,EACiD,YAAAQ,EAAA,CAAA,gBAAAC,GAAA,CAEvD,OAAAA,GACED,CACK,CACT,CAAA,GAEJ,CAAA,EAGF,MAAAE,EAAAC,EAAArB,EAAA,KAAAsB,GAAAA,EAAA,WAAA"}