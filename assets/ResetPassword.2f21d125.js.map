{"version":3,"file":"ResetPassword.2f21d125.js","sources":["../../packages/user/ResetPassword.vue"],"sourcesContent":["<template>\n  <div\n    class=\"reset-password h-screen w-full md:min-h-xl bg-bottom bg-no-repeat bg-cover dark:filter dark:brightness-75\"\n  >\n    <!-- Mobile view -->\n    <div\n      v-if=\"screenSizes['<md']\"\n      class=\"flex-wrap content-between w-full h-full p-5 shadow filter drop-shadow-md backdrop-filter backdrop-blur-sm flex\"\n    >\n      <div class=\"w-full text-center\">\n        <Logo :larger=\"20\" />\n        <div class=\"text-lg\">\n          {{ t('user.reset-password.title') }}\n        </div>\n      </div>\n      <div class=\"w-full space-y-3\">\n        <div>\n          <div class=\"flex w-full border-b border-black dark:border-white\">\n            <div class=\"i-uil:padlock align-middle text-2xl\" />\n            <input\n              v-model=\"password\"\n              type=\"password\"\n              class=\"outline-none w-full bg-transparent placeholder-gray-700 text-gray-700 dark:placeholder-white dark:text-white\"\n              :placeholder=\"t('user.reset-password.password.placeholder')\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\">\n            {{ passwordStatus }}\n          </div>\n        </div>\n        <div>\n          <div class=\"flex w-full border-b border-black dark:border-white\">\n            <div class=\"i-uil:padlock align-middle text-2xl\" />\n            <input\n              v-model=\"password2\"\n              type=\"password\"\n              class=\"outline-none w-full bg-transparent placeholder-gray-700 text-gray-700 dark:placeholder-white dark:text-white\"\n              :placeholder=\"t('user.reset-password.password2.placeholder')\"\n              @keydown.enter=\"reset\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\">\n            {{ password2Status }}\n          </div>\n        </div>\n        <div class=\"space-y-1\">\n          <button\n            :disabled=\"resetStatus === 'loading'\"\n            class=\"w-full py-2 border border-transparent rounded-md text-white bg-blue-600 focus:outline-none focus:ring-2 focus:bg-blue-700 disabled:bg-blue-300 disabled:focus:bg-blue-300\"\n            @click=\"reset\"\n          >\n            {{\n              resetStatus === 'loading'\n                ? t('user.reset-password.reset-status.loading')\n                : t('user.reset-password.reset-status.ready')\n            }}\n          </button>\n          <div v-if=\"resetStatus === 'error'\" class=\"text-red-500\">\n            {{ errmsg }}\n          </div>\n        </div>\n      </div>\n      <!-- This div is only for placeholder  -->\n      <div class=\"h-20 w-full\" />\n      <div>© VoileLabs 2019-2022</div>\n    </div>\n    <!-- Desktop view -->\n    <div\n      v-else\n      class=\"flex-wrap content-between w-80 h-full p-5 bg-white bg-opacity-50 filter drop-shadow-md backdrop-filter backdrop-blur-sm ml-48 text-black flex\"\n    >\n      <div class=\"w-full\">\n        <Logo :larger=\"20\" />\n        <div class=\"text-lg text-center\">\n          {{ t('user.reset-password.title') }}\n        </div>\n      </div>\n      <div class=\"w-full space-y-3\">\n        <div>\n          <div class=\"flex w-full border-b border-black\">\n            <div class=\"i-uil:padlock align-middle text-2xl\" />\n            <input\n              v-model=\"password\"\n              type=\"password\"\n              class=\"outline-none w-full bg-transparent placeholder-gray-700 text-gray-700\"\n              :placeholder=\"t('user.reset-password.password.placeholder')\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\">\n            {{ passwordStatus }}\n          </div>\n        </div>\n        <div>\n          <div class=\"flex w-full border-b border-black\">\n            <div class=\"i-uil:padlock align-middle text-2xl\" />\n            <input\n              v-model=\"password2\"\n              type=\"password\"\n              class=\"outline-none w-full bg-transparent placeholder-gray-700 text-gray-700\"\n              :placeholder=\"t('user.reset-password.password2.placeholder')\"\n              @keydown.enter=\"reset\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\">\n            {{ password2Status }}\n          </div>\n        </div>\n        <div class=\"space-y-1\">\n          <button\n            :disabled=\"resetStatus === 'loading'\"\n            class=\"w-full py-2 border border-transparent rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:bg-blue-700 disabled:bg-blue-300 disabled:focus:bg-blue-300 disabled:hover:bg-blue-300 disabled:hover:cursor-not-allowed\"\n            @click=\"reset\"\n          >\n            {{\n              resetStatus === 'loading'\n                ? t('user.reset-password.reset-status.loading')\n                : t('user.reset-password.reset-status.ready')\n            }}\n          </button>\n          <div v-if=\"resetStatus === 'error'\" class=\"text-red-500\">\n            {{ errmsg }}\n          </div>\n        </div>\n      </div>\n      <!-- This div is only for placeholder  -->\n      <div class=\"h-20 w-full\" />\n      <div>© VoileLabs 2019-2022</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, ref } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\nimport { screenSizes } from '@/css'\nimport { resDataStatus } from '@/common/libs/resDataStatus'\nimport { setSiteTitle } from '@/common/libs/setSiteTitle'\nimport Logo from '@/common/components/Logo.vue'\n\nconst { t } = useI18n()\nconst route = useRoute()\nconst router = useRouter()\nsetSiteTitle(`${t('user.reset-password.title')} - PatchyVideo`)\n\nconst resetStatus = ref<'ready' | 'loading' | 'error'>('ready')\nconst PasswordStatus = {\n  fine: t('user.reset-password.password.password-status.fine'),\n  tip: t('user.reset-password.password.password-status.tip'),\n  msg: t('user.reset-password.password.password-status.msg'),\n}\nconst passwordStatus = ref<string>(PasswordStatus.fine)\nconst Password2Status = {\n  fine: t('user.reset-password.password2.password2-status.fine'),\n  tip: t('user.reset-password.password2.password2-status.tip'),\n  msg: t('user.reset-password.password2.password2-status.msg'),\n}\nconst password2Status = ref<string>(Password2Status.fine)\n\nconst password = ref<string>()\nconst password2 = ref<string>()\nconst resetKey = computed(() => route.query.key)\nconst errmsg = ref<string>('')\n\nasync function reset(): Promise<void> {\n  if (resetStatus.value === 'loading')\n    return\n  resetStatus.value = 'loading'\n\n  /* Form validation  */\n  let valid = true\n  if (!password.value) {\n    valid = false\n    passwordStatus.value = PasswordStatus.tip\n  }\n  else if (password.value.length < 6 || password.value.length > 64) {\n    valid = false\n    passwordStatus.value = PasswordStatus.msg\n  }\n  else {\n    passwordStatus.value = PasswordStatus.fine\n  }\n  if (!password2.value) {\n    valid = false\n    password2Status.value = Password2Status.tip\n  }\n  else if (password2.value !== password.value) {\n    valid = false\n    password2Status.value = Password2Status.msg\n  }\n  else {\n    password2Status.value = Password2Status.fine\n  }\n  if (!resetKey.value) {\n    resetStatus.value = 'error'\n    errmsg.value = t('user.reset-password.reset-status.error')\n    return\n  }\n  if (!valid) {\n    resetStatus.value = 'ready'\n    return\n  }\n\n  await fetch('https://patchyvideo.com/be/user/resetpass.do', {\n    method: 'POST',\n    headers: new Headers({\n      'Content-Type': 'application/json',\n    }),\n    body: JSON.stringify({\n      reset_key: resetKey.value,\n      new_pass: password.value,\n    }),\n    credentials: 'include',\n  })\n    .then(data => data.json())\n    .then((res) => {\n      // console.log(res)\n      if (res.status === resDataStatus.SUCCEED) {\n        router.push({ path: '/user/redirect', query: { from: 'reset-password' } })\n      }\n      else {\n        resetStatus.value = 'error'\n        errmsg.value = res.dataerr.reason\n      }\n    })\n    .catch((err) => {\n      // console.log(err)\n      resetStatus.value = 'error'\n      errmsg.value = err\n    })\n}\n</script>\n\n<style lang=\"postcss\" scoped>\n@media (max-width: 720px) {\n  .reset-password {\n    background-image: url('./assets/SignupMobile.jpg');\n  }\n}\n@media (min-width: 720px) {\n  .reset-password {\n    background-image: url('./assets/Signup.jpg');\n  }\n}\n</style>\n"],"names":["t","useI18n","route","useRoute","router","useRouter","setSiteTitle","resetStatus","ref","PasswordStatus","passwordStatus","Password2Status","password2Status","password","password2","resetKey","computed","errmsg","reset","valid","data","res","resDataStatus","err"],"mappings":"4lEA4IA,KAAA,CAAA,EAAAA,GAAAC,IACAC,EAAAC,IACAC,EAAAC,IACAC,EAAA,GAAAN,EAAA,2BAAA,iBAAA,EAEA,MAAAO,EAAAC,EAAA,OAAA,EACAC,EAAA,CAAuB,KAAAT,EAAA,mDAAA,EACsC,IAAAA,EAAA,kDAAA,EACF,IAAAA,EAAA,kDAAA,CACA,EAE3DU,EAAAF,EAAAC,EAAA,IAAA,EACAE,EAAA,CAAwB,KAAAX,EAAA,qDAAA,EACuC,IAAAA,EAAA,oDAAA,EACF,IAAAA,EAAA,oDAAA,CACA,EAE7DY,EAAAJ,EAAAG,EAAA,IAAA,EAEAE,EAAAL,IACAM,EAAAN,IACAO,EAAAC,EAAA,IAAAd,EAAA,MAAA,GAAA,EACAe,EAAAT,EAAA,EAAA,EAEA,eAAAU,GAAA,CACE,GAAAX,EAAA,QAAA,UACE,OACFA,EAAA,MAAA,UAGA,IAAAY,EAAA,GAuBA,GAtBAN,EAAA,MAEwCA,EAAA,MAAA,OAAA,GAAAA,EAAA,MAAA,OAAA,IAGtCM,EAAA,GACAT,EAAA,MAAAD,EAAA,KAGAC,EAAA,MAAAD,EAAA,MARAU,EAAA,GACAT,EAAA,MAAAD,EAAA,KASFK,EAAA,MAE0CA,EAAA,QAAAD,EAAA,OAGxCM,EAAA,GACAP,EAAA,MAAAD,EAAA,KAGAC,EAAA,MAAAD,EAAA,MARAQ,EAAA,GACAP,EAAA,MAAAD,EAAA,KASF,CAAAI,EAAA,MAAA,CACER,EAAA,MAAA,QACAU,EAAA,MAAAjB,EAAA,wCAAA,EACA,MAAA,CAEF,GAAA,CAAAmB,EAAA,CACEZ,EAAA,MAAA,QACA,MAAA,CAGF,MAAA,MAAA,+CAAA,CAA4D,OAAA,OAClD,QAAA,IAAA,QAAA,CACa,eAAA,kBACH,CAAA,EACjB,KAAA,KAAA,UAAA,CACoB,UAAAQ,EAAA,MACC,SAAAF,EAAA,KACD,CAAA,EACpB,YAAA,SACY,CAAA,EAAA,KAAAO,GAAAA,EAAA,MAAA,EAAA,KAAAC,GAAA,CAKXA,EAAA,SAAAC,EAAA,QACElB,EAAA,KAAA,CAAA,KAAA,iBAAA,MAAA,CAAA,KAAA,gBAAA,CAAA,CAAA,GAGAG,EAAA,MAAA,QACAU,EAAA,MAAAI,EAAA,QAAA,OACF,CAAA,EAAA,MAAAE,GAAA,CAIAhB,EAAA,MAAA,QACAU,EAAA,MAAAM,CAAe,CAAA,CAChB"}