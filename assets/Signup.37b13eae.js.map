{"version":3,"file":"Signup.37b13eae.js","sources":["../../packages/user/Signup.vue"],"sourcesContent":["<template>\n  <div\n    class=\"sign-up h-screen w-full md:min-h-xl flex justify-end bg-bottom bg-no-repeat bg-cover dark:filter dark:brightness-75\"\n  >\n    <div\n      class=\"flex flex-wrap content-between w-full md:w-80 h-full p-5 text-white lt-md:dark:text-white md:text-black bg-white bg-opacity-50 filter drop-shadow-md backdrop-filter backdrop-blur-sm lt-md:shadow md:mr-50\"\n    >\n      <div class=\"w-full lt-md:text-center\">\n        <Logo :larger=\"20\" />\n        <div class=\"text-lg text-center\" v-text=\"t('user.signup.title')\" />\n      </div>\n      <form class=\"w-full space-y-2\" autocomplete=\"on\" @submit.prevent=\"signup\">\n        <div>\n          <div class=\"flex w-full border-b border-black lt-md:dark:border-white\">\n            <div class=\"i-uil:user align-middle text-2xl\" />\n            <input\n              v-model=\"userName\"\n              type=\"text\"\n              name=\"username\"\n              autocomplete=\"username\"\n              class=\"autofill outline-none w-full bg-transparent placeholder-gray-700 text-gray-700 lt-md:dark:placeholder-white lt-md:dark:text-white\"\n              :placeholder=\"t('user.signup.username.placeholder')\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\" v-text=\"usernameStatus\" />\n        </div>\n        <div>\n          <div class=\"flex w-full border-b border-black lt-md:dark:border-white\">\n            <div class=\"i-uil:lock-open-alt align-middle text-2xl\" />\n            <input\n              v-model=\"password\"\n              type=\"password\"\n              name=\"password\"\n              autocomplete=\"new-password\"\n              class=\"autofill outline-none w-full bg-transparent placeholder-gray-700 text-gray-700 lt-md:dark:placeholder-white lt-md:dark:text-white\"\n              :placeholder=\"t('user.signup.password.placeholder')\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\" v-text=\"passwordStatus\" />\n        </div>\n        <div>\n          <div class=\"flex w-full border-b border-black lt-md:dark:border-white\">\n            <div class=\"i-uil:padlock align-middle text-2xl\" />\n            <input\n              v-model=\"password2\"\n              type=\"password\"\n              name=\"re-password\"\n              autocomplete=\"new-password\"\n              class=\"autofill outline-none w-full bg-transparent placeholder-gray-700 text-gray-700 lt-md:dark:placeholder-white lt-md:dark:text-white\"\n              :placeholder=\"t('user.signup.password2.placeholder')\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\" v-text=\"password2Status\" />\n        </div>\n        <div>\n          <div class=\"flex w-full border-b border-black lt-md:dark:border-white\">\n            <div class=\"i-uil:envelope align-middle text-2xl\" />\n            <input\n              v-model=\"email\"\n              type=\"email\"\n              name=\"email\"\n              autocomplete=\"email\"\n              class=\"autofill outline-none w-full bg-transparent placeholder-gray-700 text-gray-700 lt-md:dark:placeholder-white lt-md:dark:text-white\"\n              :placeholder=\"t('user.signup.email.placeholder')\"\n              @keydown.enter=\"signup\"\n            >\n          </div>\n          <div class=\"text-red-500 text-sm h-4\" v-text=\"emailStatus\" />\n        </div>\n        <div class=\"space-y-1\">\n          <button\n            type=\"submit\"\n            :disabled=\"signupStatus === 'loading'\"\n            class=\"w-full py-2 border border-transparent rounded-md text-white bg-blue-600 focus:outline-none focus:ring-2 focus:bg-blue-700 disabled:bg-blue-300 disabled:focus:bg-blue-300 disabled:hover:bg-blue-300 disabled:hover:cursor-not-allowed\"\n            v-text=\"\n              signupStatus === 'loading' ? t('user.signup.signup-status.loading') : t('user.signup.signup-status.ready')\n            \"\n          />\n          <div v-if=\"signupStatus === 'error'\" class=\"text-red-500\" v-text=\"errmsg\" />\n          <RouterLink\n            class=\"block text-blue-600 text-right hover:text-blue-800\"\n            to=\"/user/login\"\n          >\n            {{ `←${t('user.signup.login')}` }}\n          </RouterLink>\n        </div>\n      </form>\n      <!-- This div is only for placeholder  -->\n      <div class=\"h-20 w-full\" />\n      <div>© VoileLabs 2019-2022</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\nimport { setSiteTitle } from '@/common/libs/setSiteTitle'\nimport { resDataStatus } from '@/common/libs/resDataStatus'\nimport Logo from '@/common/components/Logo.vue'\n\nconst { t } = useI18n()\nconst router = useRouter()\nsetSiteTitle(`${t('user.signup.title')} - PatchyVideo`)\n\nconst signupStatus = ref<'ready' | 'loading' | 'error'>('ready')\nconst UsernameStatus = computed(() => ({\n  fine: t('user.signup.username.username-status.fine'),\n  tip: t('user.signup.username.username-status.tip'),\n  msg: t('user.signup.username.username-status.msg'),\n  res: t('user.signup.username.username-status.res'),\n  err: t('user.signup.username.username-status.err'),\n}))\nconst usernameStatus = ref<string>(UsernameStatus.value.fine)\nconst PasswordStatus = computed(() => ({\n  fine: t('user.signup.password.password-status.fine'),\n  tip: t('user.signup.password.password-status.tip'),\n  msg: t('user.signup.password.password-status.msg'),\n}))\nconst passwordStatus = ref<string>(PasswordStatus.value.fine)\nconst Password2Status = computed(() => ({\n  fine: t('user.signup.password2.password2-status.fine'),\n  tip: t('user.signup.password2.password2-status.tip'),\n  msg: t('user.signup.password2.password2-status.msg'),\n}))\nconst password2Status = ref<string>(Password2Status.value.fine)\nconst emailFormat\n  = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/\nconst EmailStatus = computed(() => ({\n  fine: t('user.signup.email.email-status.fine'),\n  tip: t('user.signup.email.email-status.tip'),\n  msg: t('user.signup.email.email-status.msg'),\n  res: t('user.signup.email.email-status.res'),\n  err: t('user.signup.email.email-status.err'),\n}))\nconst emailStatus = ref<string>(EmailStatus.value.fine)\n\nconst userName = ref<string>('')\nconst password = ref<string>('')\nconst password2 = ref<string>('')\nconst email = ref<string>('')\nconst errmsg = ref<string>('')\n\nasync function signup(): Promise<void> {\n  if (signupStatus.value === 'loading')\n    return\n  signupStatus.value = 'loading'\n\n  /* Form validation  */\n  let valid = true\n  if (!userName.value) {\n    valid = false\n    usernameStatus.value = UsernameStatus.value.tip\n  }\n  else if (userName.value.length < 2 || userName.value.length > 32) {\n    valid = false\n    usernameStatus.value = UsernameStatus.value.msg\n  }\n  else {\n    usernameStatus.value = UsernameStatus.value.fine\n  }\n  if (!password.value) {\n    valid = false\n    passwordStatus.value = PasswordStatus.value.tip\n  }\n  else if (password.value.length < 6 || password.value.length > 64) {\n    valid = false\n    passwordStatus.value = PasswordStatus.value.msg\n  }\n  else {\n    passwordStatus.value = PasswordStatus.value.fine\n  }\n  if (!password2.value) {\n    valid = false\n    password2Status.value = Password2Status.value.tip\n  }\n  else if (password2.value !== password.value) {\n    valid = false\n    password2Status.value = Password2Status.value.msg\n  }\n  else {\n    password2Status.value = Password2Status.value.fine\n  }\n  if (!email.value) {\n    valid = false\n    emailStatus.value = EmailStatus.value.tip\n  }\n  else if (!emailFormat.test(email.value)) {\n    valid = false\n    emailStatus.value = EmailStatus.value.msg\n  }\n  else {\n    emailStatus.value = EmailStatus.value.fine\n  }\n  if (valid) {\n    const fetchUser = fetch('https://patchyvideo.com/be/user/exists.do', {\n      method: 'POST',\n      headers: new Headers({\n        'Content-Type': 'application/json',\n      }),\n      body: JSON.stringify({\n        username: userName.value,\n      }),\n      credentials: 'include',\n    })\n      .then(data => data.json())\n      .then((res) => {\n        // console.log(res)\n        if (res.status !== resDataStatus.SUCCEED) {\n          usernameStatus.value = UsernameStatus.value.err\n          valid = false\n        }\n        // 'res.data=true' means the user already exists\n        else if (res.data) {\n          usernameStatus.value = UsernameStatus.value.res\n          valid = false\n        }\n      })\n      .catch(() => {\n        // console.log(err)\n        usernameStatus.value = UsernameStatus.value.err\n        valid = false\n      })\n    const fetchEmail = fetch('https://patchyvideo.com/be/user/email_avail.do', {\n      method: 'POST',\n      headers: new Headers({\n        'Content-Type': 'application/json',\n      }),\n      body: JSON.stringify({\n        email: email.value,\n      }),\n      credentials: 'include',\n    })\n      .then(data => data.json())\n      .then((res) => {\n        // console.log(res)\n        if (res.status !== resDataStatus.SUCCEED) {\n          emailStatus.value = EmailStatus.value.err\n          valid = false\n        }\n        // 'res.data=true' means the user already exists\n        else if (res.data) {\n          emailStatus.value = EmailStatus.value.res\n          valid = false\n        }\n      })\n      .catch(() => {\n        // console.log(err)\n        emailStatus.value = EmailStatus.value.err\n        valid = false\n      })\n    await fetchUser\n    await fetchEmail\n  }\n  if (!valid) {\n    signupStatus.value = 'ready'\n    return\n  }\n\n  /* Sign up */\n  let session = ''\n  await fetch('https://patchyvideo.com/be/auth/get_session.do', {\n    method: 'POST',\n    headers: new Headers({\n      'Content-Type': 'application/json',\n    }),\n    body: JSON.stringify({ type: 'SIGNUP' }),\n    credentials: 'include',\n  })\n    .then(data => data.json())\n    .then((res) => {\n      // console.log(res)\n      if (res.status === resDataStatus.SUCCEED) { session = res.data }\n      else {\n        signupStatus.value = 'error'\n        errmsg.value = t('user.signup.signup-status.error')\n      }\n    })\n    .catch((err) => {\n      // console.log(err)\n      signupStatus.value = 'error'\n      errmsg.value = err\n    })\n\n  await fetch('https://patchyvideo.com/be/signup.do', {\n    method: 'POST',\n    headers: new Headers({\n      'Content-Type': 'application/json',\n    }),\n    body: JSON.stringify({\n      username: userName.value,\n      password: password.value,\n      email: email.value,\n      session,\n    }),\n    credentials: 'include',\n  })\n    .then(data => data.json())\n    .then((res) => {\n      // console.log(res)\n      if (res.status === resDataStatus.SUCCEED) {\n        router.push({ path: '/user/redirect', query: { from: 'sign-up' } })\n      }\n      else {\n        signupStatus.value = 'error'\n        errmsg.value = res.dataerr.reason\n      }\n    })\n    .catch((err) => {\n      // console.log(err)\n      signupStatus.value = 'error'\n      errmsg.value = err\n    })\n}\n</script>\n\n<style lang=\"postcss\" scoped>\n@media (max-width: 720px) {\n  .sign-up {\n    background-image: url('./assets/SignupMobile.jpg');\n  }\n}\n@media (min-width: 720px) {\n  .sign-up {\n    background-image: url('./assets/Signup.jpg');\n  }\n}\n\n.autofill:-webkit-autofill,\n.autofill:-webkit-autofill:hover,\n.autofill:-webkit-autofill:focus {\n  transition: background-color 5000s ease-in-out 0s;\n  /* -webkit-text-fill-color: theme('colors.blue.300'); */\n  -webkit-text-fill-color: #93c5fd;\n}\n@media (min-width: 720px) {\n  .autofill:-webkit-autofill,\n  .autofill:-webkit-autofill:hover,\n  .autofill:-webkit-autofill:focus {\n    /* -webkit-text-fill-color: theme('colors.blue.900'); */\n    -webkit-text-fill-color: #1e3a8a;\n  }\n}\n</style>\n"],"names":["useI18n","router","useRouter","setSiteTitle","signupStatus","ref","UsernameStatus","computed","usernameStatus","PasswordStatus","passwordStatus","Password2Status","password2Status","emailFormat","EmailStatus","emailStatus","userName","password","password2","email","errmsg","signup","valid","fetchUser","data","res","resDataStatus","fetchEmail","session","err"],"mappings":"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"}