{"version":3,"file":"Author.d1d35260.js","sources":["../../packages/tag/Author.vue"],"sourcesContent":["<template>\n  <LayoutDefault>\n    <div v-if=\"author\" class=\"max-w-screen-xl mx-auto\">\n      <!-- padding for profile background -->\n      <div class=\"w-full aspect-ratio-6/1 bg-gray-200 dark:bg-gray-600\" />\n      <!-- basic info -->\n      <div class=\"flex flex-row lt-sm:mt-2 ml-4 md:ml-16\">\n        <div class=\"aspect-ratio-1/1 flex-shrink-0 flex-grow-0 sm:-mt-16\">\n          <div\n            class=\"overflow-hidden border-2 border-gray-300 dark:border-gray-800 transform transition-all ease duration-300\"\n            :style=\"{ borderRadius: isHoveringAvatar ? '0.25rem' : screenSizes.md ? '14rem' : '5rem' }\"\n            @mouseenter=\"() => isHoveringAvatar = true\"\n            @mouseleave=\"() => isHoveringAvatar = false\"\n          >\n            <UserAvatar\n              class=\"w-20 h-20 md:w-56 md:h-56 cursor-pointer\"\n              openable\n              hide-title\n              :alt=\"author.tagname\"\n              :image=\"author.avatar\"\n            />\n          </div>\n        </div>\n        <div class=\"mt-1 sm:mt-2 ml-2 sm:ml-6\">\n          <!-- username -->\n          <h1 class=\"text-lg sm:text-2xl font-bold\" v-text=\"author.tagname\" />\n          <div class=\"text-md sm:text-base text-gray-800 dark:text-gray-300\">\n            {{ t(`tag.author.type.${author.type}`)\n            }}<template v-if=\"author.urls.length > 0\">\n              &dot;\n              <div class=\"inline-flex align-middle flex-row space-x-1 flex-nowrap\">\n                <a\n                  v-for=\"url in author.urls\"\n                  :key=\"url\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  :href=\"url\"\n                  class=\"inline-block text-lg\"\n                  :class=\"getIconForSite(getUrlSite(url))\"\n                />\n              </div>\n            </template>\n          </div>\n          <!-- bio -->\n          <p class=\"whitespace-pre break-normal line-clamp-4\" v-text=\"author.desc\" />\n        </div>\n      </div>\n      <div class=\"mt-4 ml-8\">\n        <PvTabs\n          v-model=\"tab\"\n          :tabs=\"tabs\"\n        >\n          <template #author-videos>\n            <div v-if=\"authorVideos\">\n              <div class=\"flex flex-nowrap gap-2\">\n                <span>{{ author.tagname }}共发布了 {{ authorVideos.count }} 个视频</span>\n                <RouterLink\n                  :to=\"{ path: '/search-result', query: { i: author.tagname } }\"\n                  class=\"flex text-purple-600 flex-nowrap items-center gap-0.5 dark:text-white dark:border-b dark:border-gray-400\"\n                >\n                  查看全部<span class=\"i-uil:external-link-alt text-lg\" />\n                </RouterLink>\n              </div>\n              <div\n                class=\"grid mt-2 grid-cols-5 grid-flow-row gap-x-2\"\n              >\n                <RouterLink\n                  v-for=\"video in authorVideos.videos\"\n                  :key=\"video.id.toHexString()\"\n                  :to=\"`/video/${video.id.toHexString()}`\"\n                  class=\"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-100\"\n                >\n                  <Cover\n                    :title=\"video.item.title\"\n                    :cover-image=\"video.item.coverImage\"\n                    class=\"rounded-md border border-gray-200 dark:border-gray-800\"\n                  />\n                  <a\n                    class=\"w-full text-sm overflow-hidden line-clamp-2 overflow-ellipsis\"\n                    v-text=\"video.item.title\"\n                  />\n                  <div class=\"w-full text-xs truncate text-gray-600 dark:text-gray-300 font-light\">\n                    <Suspense><RelativeDate :date=\"video.meta.createdAt\" /></Suspense>&nbsp;\n                  </div>\n                </RouterLink>\n              </div>\n            </div>\n          </template>\n        </PvTabs>\n      </div>\n    </div>\n  </LayoutDefault>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, ref, watchEffect } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { useI18n } from 'vue-i18n'\nimport { gql, useQuery, useResult } from '@/graphql'\nimport type { Query } from '@/graphql'\nimport { setSiteTitle } from '@/common/libs/setSiteTitle'\nimport UserAvatar from '@/user/components/UserAvatar.vue'\nimport RelativeDate from '@/date-fns/components/RelativeDate.vue'\nimport Cover from '@/video/components/Cover.vue'\nimport { screenSizes } from '@/css'\nimport { startProgress, stopProgress } from '@/nprogress'\nimport PvTabs from '@/ui/components/PvTabs.vue'\n\nconst { t } = useI18n()\nconst route = useRoute()\n\nconst tid = computed(() => Number(route.params.tid as string))\nconst { result, loading } = useQuery<Query>(\n  gql`\n    query ($tid: Int!) {\n      getAuthor(para: { tagid: $tid }) {\n        tagname\n        type\n        desc\n        avatar\n        urls\n        commonTags {\n          id\n          languages {\n            lang\n            value\n          }\n        }\n      }\n    }\n  `,\n  {\n    tid,\n  },\n)\n\nwatchEffect(() => {\n  if (loading.value)\n    startProgress()\n  else\n    stopProgress()\n})\n\n// basic info\nconst author = useResult(result, null, data => data?.getAuthor)\n// change title\nwatchEffect(() => {\n  if (author.value)\n    setSiteTitle(t('tag.author.title', { tagname: author.value.tagname }))\n})\n\nconst getUrlSite = (url: string): string => {\n  const urlo = new URL(url)\n  if (urlo.hostname.endsWith('bilibili.com'))\n    return 'bilibili'\n  if (urlo.hostname.endsWith('youtube.com'))\n    return 'youtube'\n  // TODO find a niconico icon (real hard)\n  // if (urlo.hostname.endsWith('nicovideo.jp')) return 'nicovideo'\n  if (urlo.hostname.endsWith('twitter.com'))\n    return 'twitter'\n  return 'other'\n}\nconst getIconForSite = (site: string): string => {\n  switch (site) {\n    case 'bilibili':\n      return 'i-ri:bilibili-line'\n    case 'youtube':\n      return 'i-uil:youtube-alt'\n    case 'twitter':\n      return 'i-uil:twitter-alt'\n    default:\n      return 'i-uil:link-alt'\n  }\n}\n\nconst isHoveringAvatar = ref(false)\n\nconst tabs = [\n  { name: 'author-videos', label: '发布的视频' },\n]\nconst tab = ref<typeof tabs[number]['name']>('author-videos')\n\n// author's videos\nconst { result: authorVideosRes } = useQuery<Query>(\n  gql`\n    query ($limit: Int!, $query: String!, $order: String!) {\n      listVideo(\n        para: {\n          offset: 0\n          limit: $limit\n          humanReadableTag: true\n          query: $query\n          order: $order\n          qtype: \"tag\"\n        }\n      ) {\n        count\n        videos {\n          id\n          item {\n            title\n            coverImage\n          }\n          meta {\n            createdAt\n          }\n        }\n      }\n    }\n  `,\n  {\n    limit: 20,\n    query: computed(() => author.value?.tagname),\n    order: 'last_modified',\n  },\n  () => ({\n    enabled: !!author.value?.tagname,\n  }),\n)\n\nconst authorVideos = useResult(authorVideosRes, null, data => data?.listVideo)\n</script>\n"],"names":["t","useI18n","route","useRoute","tid","computed","result","loading","useQuery","gql","watchEffect","startProgress","stopProgress","author","useResult","data","setSiteTitle","getUrlSite","url","urlo","getIconForSite","site","isHoveringAvatar","ref","tabs","tab","authorVideosRes","_a","authorVideos"],"mappings":"shDA4GA,KAAA,CAAA,EAAAA,GAAAC,IACAC,EAAAC,IAEAC,EAAAC,EAAA,IAAA,OAAAH,EAAA,OAAA,GAAA,CAAA,EACA,CAAA,OAAAI,EAAA,QAAAC,CAAA,EAAAC,EAA4BC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAC1B,CAkBA,IAAAL,CACE,CACF,EAGFM,EAAA,IAAA,CACEH,EAAA,MACEI,IAEAC,GAAa,CAAA,EAIjB,MAAAC,EAAAC,EAAAR,EAAA,KAAAS,GAAAA,GAAA,YAAAA,EAAA,SAAA,EAEAL,EAAA,IAAA,CACEG,EAAA,OACEG,EAAAhB,EAAA,mBAAA,CAAA,QAAAa,EAAA,MAAA,OAAA,CAAA,CAAA,CAAqE,CAAA,EAGzE,MAAAI,EAAAC,GAAA,CACE,MAAAC,EAAA,IAAA,IAAAD,CAAA,EACA,OAAAC,EAAA,SAAA,SAAA,cAAA,EACE,WACFA,EAAA,SAAA,SAAA,aAAA,EACE,UAGFA,EAAA,SAAA,SAAA,aAAA,EACE,UACF,OAAO,EAETC,EAAAC,GAAA,CACE,OAAAA,EAAA,CAAc,IAAA,WAEV,MAAA,qBAAO,IAAA,UAEP,MAAA,oBAAO,IAAA,UAEP,MAAA,oBAAO,QAEP,MAAA,gBAAO,CACX,EAGFC,EAAAC,EAAA,EAAA,EAEAC,EAAA,CAAa,CAAA,KAAA,gBAAA,MAAA,OAAA,CAC6B,EAE1CC,EAAAF,EAAA,eAAA,EAGA,CAAA,OAAAG,CAAA,EAAAlB,EAAoCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAClC,CA0BA,MAAA,GACS,MAAAJ,EAAA,IAAA,OAAA,OAAAsB,EAAAd,EAAA,QAAA,YAAAc,EAAA,QAAA,EACoC,MAAA,eACpC,EACT,IAAA,OAAA,OACO,QAAA,CAAA,GAAAA,EAAAd,EAAA,QAAA,MAAAc,EAAA,QACoB,EAC3B,EAGFC,EAAAd,EAAAY,EAAA,KAAAX,GAAAA,GAAA,YAAAA,EAAA,SAAA"}